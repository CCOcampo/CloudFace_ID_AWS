# Facial Recognition Authentication System

This project implements a facial recognition-based authentication system using AWS services. The system processes images uploaded by visitors, verifies identities using Amazon Rekognition, and provides authentication results via an API Gateway.

<center>
  <img src="https://github.com/CCOcampo/CloudFace_ID_AWS/blob/master/resource/app_rekog.png" alt="App Rekognition" width="500">
</center>

## Architecture Overview

<center>
  <img src="https://github.com/CCOcampo/CloudFace_ID_AWS/blob/master/resource/Arquitecture.png" alt="App Rekognition" width="600">
</center>

The system consists of the following components:

1. **S3 Buckets**

   - `employee-images-storage`: Stores images of registered employees.
   - `visitor-images-storage`: Stores images of visitors who attempt authentication.

2. **IAM Roles**

   - A role that grants permissions for Lambda functions, API Gateway, Rekognition, DynamoDB, and S3 operations.

3. **AWS Lambda Functions**

   - `upload_image_lambda`: Handles image uploads to the S3 bucket.
   - `authenticate_lambda`: Uses Amazon Rekognition to compare the visitor's image with stored employee images.

4. **DynamoDB Table**

   - Stores employee information, including image metadata and user details.

5. **Amazon Rekognition**

   - Compares visitor images with employee images to determine authentication status.

6. **API Gateway**
   - Exposes the Lambda authentication function to a frontend application.

## How It Works

1. A visitor uploads their image through the frontend.
2. The image is sent to `visitor-images-storage` using API Gateway.
3. `upload_image_lambda` stores the image in the appropriate S3 bucket.
4. `authenticate_lambda` triggers Amazon Rekognition to compare the image against employee images.
5. If a match is found, the system retrieves employee details from DynamoDB and authenticates the visitor.
6. The API Gateway returns the authentication result to the frontend.

## Deployment

To deploy this system using Terraform, follow these steps:

1. **Ensure AWS Credentials**

   - You must have an **AWS IAM user** with the necessary permissions to deploy resources.
   - Configure your AWS credentials by running:
     ```sh
     aws configure
     ```
   - Alternatively, ensure your environment variables are set:
     ```sh
     export AWS_ACCESS_KEY_ID=your-access-key
     export AWS_SECRET_ACCESS_KEY=your-secret-key
     export AWS_REGION=your-region
     ```

2. **Specify the path for your Lambda function code**:
   Before applying the Terraform deployment, update the `2.bucket.tf` file with the correct paths for your `.zip` files. For example, this is my personal path

   ```
   /Users/cristhiancamiloocampo/Documents/Proyecto_Data/Git/CloudFace_ID_AWS/employee_regis.zip
   /Users/cristhiancamiloocampo/Documents/Proyecto_Data/Git/CloudFace_ID_AWS/employee_authen.zip
   ```

   Make sure these paths match where your Lambda function code is stored.

3. **Initialize Terraform**

   ```sh
   terraform init
   ```

4. **Plan the Deployment**

   - Terraform will show what changes it will make before applying them:
     ```sh
     terraform plan
     ```

5. **Apply the Deployment**

   ```sh
   terraform apply -auto-approve
   ```

6. **Upload Employee Images to S3 Bucket**

- After deployment, **upload your employee images** to the S3 bucket created by Terraform (`employee-images-bucket`). You can use the images that i have in the **images** folder.
- _Important_: These images will be used to create the Rekognition Face Collection.

7. **Update the App with the API Gateway URL**

   - Once the deployment is complete, Terraform will output the **API Gateway URL**.
   - Modify the `facial-rekognition/src/App.js` file and update the API URL:

     ```js
     const requestUrl =
       "https://your-api-gateway-url.amazonaws.com/DEV/employee";
     ```

     And also in this section

     ```js
     fetch(
      `https://your-api-gateway-url.amazonaws.com/DEV/visitor-images-storage-rk1/${visitorImageName}.jpeg`...
     ```

   - Replace `"your-api-gateway-url"` with the actual URL generated by Terraform.

8. **Run the Application**
   - Navigate to the app's root folder and install dependencies:
     ```sh
     cd facial-rekognition
     npm install
     ```
   - Start the app:
     ```sh
     npm start
     ```

## API Endpoints

| Method | Endpoint                               | Description                                 |
| ------ | -------------------------------------- | ------------------------------------------- |
| `PUT`  | `/upload`                              | Uploads an image to S3                      |
| `GET`  | `/authenticate?objectKey={image-name}` | Authenticates a visitor by comparing images |

## Frontend Integration

The frontend application interacts with the API Gateway to:

- Upload visitor images.
- Retrieve authentication results.

## AWS Policies Used

- `AmazonS3FullAccess`
- `AmazonDynamoDBFullAccess`
- `AmazonRekognitionFullAccess`
- `AWSLambdaBasicExecutionRole`
- `AmazonAPIGatewayInvokeFullAccess`

## Working with Images Instead of Live Camera

If you prefer to work with static images instead of the live camera, you can easily modify the project to support this.

<center>
  <img src="https://github.com/CCOcampo/CloudFace_ID_AWS/blob/master/resource/images_rekog.png" alt="App Rekognition" width="500">
</center>

#### How to Switch to Image-Based Recognition

1. **Replace `facial-rekognition/src/App.js`**

   - Instead of using the current `App.js` file, use the one provided in `Second_option/App.js`.
   - Copy the contents of `Second_option/App.js` and replace the code in `facial-rekognition/src/App.js`.

2. **Replace `facial-rekognition/src/App.css`**
   - Similarly, update the styles by replacing `facial-rekognition/src/App.css` with the contents of `Second_option/App.css`.

## Future Enhancements

- Store authentication logs in CloudWatch for monitoring the Api Gateway.
- Optimize Lambda execution time for faster response.
- **Automatically authenticate** users when they remain in front of the camera without clicking a button.
- **Integrate Wikipedia API** to display additional information about recognized employees.

## Contribute

We welcome contributions to improve this project! ðŸš€ If you have ideas for enhancements, feel free to open an issue or submit a pull request.

Let us know if you need help getting started! ðŸ˜ƒ
